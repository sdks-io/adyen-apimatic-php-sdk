<?php

declare(strict_types=1);

/*
 * AdyenApIsLib
 *
 * This file was automatically generated by APIMATIC v3.0 ( https://www.apimatic.io ).
 */

namespace AdyenApIsLib\Apis;

use AdyenApIsLib\Exceptions\ServiceErrorException;
use AdyenApIsLib\Http\ApiResponse;
use AdyenApIsLib\Models\CardDetailsRequest;
use AdyenApIsLib\Models\CardDetailsResponse;
use AdyenApIsLib\Models\CreateCheckoutSessionRequest;
use AdyenApIsLib\Models\CreateCheckoutSessionResponse;
use AdyenApIsLib\Models\PaymentDetailsRequest;
use AdyenApIsLib\Models\PaymentDetailsResponse;
use AdyenApIsLib\Models\PaymentMethodsRequest;
use AdyenApIsLib\Models\PaymentMethodsResponse;
use AdyenApIsLib\Models\PaymentRequest;
use AdyenApIsLib\Models\PaymentResponse;
use AdyenApIsLib\Models\SessionResultResponse;
use Core\Request\Parameters\BodyParam;
use Core\Request\Parameters\HeaderParam;
use Core\Request\Parameters\QueryParam;
use Core\Request\Parameters\TemplateParam;
use Core\Response\Types\ErrorType;
use CoreInterfaces\Core\Request\RequestMethod;

class PaymentsApi extends BaseApi
{
    /**
     * Use this endpoint to get information about the card or network token that enables you to decide on
     * the routing of the transaction and the eligibility of the card for the type of transaction.
     *
     * If you include [your supported brands](https://docs.adyen.com/api-
     * explorer/#/CheckoutService/latest/post/cardDetails__reqParam_supportedBrands) in the request, the
     * response also tells you if you support each [brand that was identified on the card](https://docs.
     * adyen.com/api-explorer/Checkout/latest/post/cardDetails#responses-200-brands).
     *
     * If you have an API-only integration and collect card data, use this endpoint to find out if the
     * shopper's card is co-bad. For co-badged cards, you must let the shopper choose the brand to pay with
     * if you support both brands.
     *
     * ## Server-side API libraries
     * We provide open-source [server-side API libraries](https://docs.adyen.com/development-
     * resources/libraries/) in several languages:
     * - PHP
     * - Java
     * - Node.js
     * - .NET
     * - Go
     * - Python
     * - Ruby
     * - Apex (beta)
     *
     * See our [integration examples](https://github.com/adyen-examples#%EF%B8%8F-official-integration-
     * examples) for example uses of the libraries.
     *
     * ## Developer resources
     * BIN Lookup API is available through a Postman collection. Click the button below to create a fork,
     * then set the environment variables at **Environments**&nbsp;>&nbsp;**Adyen&nbsp;APIs**.
     *
     * [![Run in Postman](https://run.pstmn.io/button.svg)](https://god.gw.postman.com/run-
     * collection/25716737-677c7679-a695-4ebb-91da-68b4e7c9228a?
     * action=collection%2Ffork&source=rip_markdown&collection-url=entityId%3D25716737-677c7679-a695-4ebb-
     * 91da-68b4e7c9228a%26entityType%3Dcollection%26workspaceId%3Da8d63f9f-cfc7-4810-90c5-9e0c60030d3e#?
     * env%5BAdyen%20APIs%5D=W3sia2V5IjoiWC1BUEktS2V5IiwidmFsdWUiOiIiLCJlbmFibGVkIjp0cnVlLCJ0eXBlIjoic2Vjcm
     * V0In0seyJrZXkiOiJZT1VSX01FUkNIQU5UX0FDQ09VTlQiLCJ2YWx1ZSI6IiIsImVuYWJsZWQiOnRydWUsInR5cGUiOiJkZWZhdW
     * x0In0seyJrZXkiOiJZT1VSX0NPTVBBTllfQUNDT1VOVCIsInZhbHVlIjoiIiwiZW5hYmxlZCI6dHJ1ZSwidHlwZSI6ImRlZmF1bH
     * QifSx7ImtleSI6IllPVVJfQkFMQU5DRV9QTEFURk9STSIsInZhbHVlIjoiIiwiZW5hYmxlZCI6dHJ1ZSwidHlwZSI6ImRlZmF1bH
     * QifV0=)
     *
     *
     *
     *
     * @param string|null $idempotencyKey A unique identifier for the message with a maximum of 64
     *        characters (we recommend a UUID).
     * @param CardDetailsRequest|null $body
     *
     * @return ApiResponse Response from the API call
     */
    public function getCardDetails(?string $idempotencyKey = null, ?CardDetailsRequest $body = null): ApiResponse
    {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/cardDetails')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                HeaderParam::init('Content-Type', 'application/json'),
                HeaderParam::init('Idempotency-Key', $idempotencyKey),
                BodyParam::init($body)
            );

        $_resHandler = $this->responseHandler()->type(CardDetailsResponse::class)->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Retrieves the list of available payment methods for the transaction, based on the transaction
     * information like amount, country, and currency.
     *
     * @param string|null $idempotencyKey A unique identifier for the message with a maximum of 64
     *        characters (we recommend a UUID).
     * @param PaymentMethodsRequest|null $body
     *
     * @return ApiResponse Response from the API call
     */
    public function getPaymentMethods(?string $idempotencyKey = null, ?PaymentMethodsRequest $body = null): ApiResponse
    {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/paymentMethods')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                HeaderParam::init('Content-Type', 'application/json'),
                HeaderParam::init('Idempotency-Key', $idempotencyKey),
                BodyParam::init($body)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn(
                '400',
                ErrorType::init(
                    'Bad Request - a problem reading or understanding the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '401',
                ErrorType::init('Unauthorized - authentication required.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '403',
                ErrorType::init(
                    'Forbidden - insufficient permissions to process the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '422',
                ErrorType::init('Unprocessable Entity - a request validation error.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '500',
                ErrorType::init(
                    'Internal Server Error - the server could not process the request.',
                    ServiceErrorException::class
                )
            )
            ->type(PaymentMethodsResponse::class)
            ->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Sends payment parameters (like amount, country, and currency) together with other required input
     * details collected from the shopper. To know more about required parameters for specific payment
     * methods, refer to our [payment method guides](https://docs.adyen.com/payment-methods).
     * The response depends on the [payment flow](https://docs.adyen.com/payment-methods#payment-flow):
     * * For a direct flow, the response includes a `pspReference` and a `resultCode` with the payment
     * result, for example **Authorised** or **Refused**.
     * * For a redirect or additional action, the response contains an `action` object.
     *
     * @param string|null $idempotencyKey A unique identifier for the message with a maximum of 64
     *        characters (we recommend a UUID).
     * @param PaymentRequest|null $body
     *
     * @return ApiResponse Response from the API call
     */
    public function createPayment(?string $idempotencyKey = null, ?PaymentRequest $body = null): ApiResponse
    {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/payments')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                HeaderParam::init('Content-Type', 'application/json'),
                HeaderParam::init('Idempotency-Key', $idempotencyKey),
                BodyParam::init($body)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn(
                '400',
                ErrorType::init(
                    'Bad Request - a problem reading or understanding the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '401',
                ErrorType::init('Unauthorized - authentication required.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '403',
                ErrorType::init(
                    'Forbidden - insufficient permissions to process the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '422',
                ErrorType::init('Unprocessable Entity - a request validation error.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '500',
                ErrorType::init(
                    'Internal Server Error - the server could not process the request.',
                    ServiceErrorException::class
                )
            )
            ->type(PaymentResponse::class)
            ->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Submits details for a payment created using `/payments`. This step is only needed when no final
     * state has been reached on the `/payments` request, for example when the shopper was redirected to
     * another page to complete the payment.
     *
     *
     *
     * @param string|null $idempotencyKey A unique identifier for the message with a maximum of 64
     *        characters (we recommend a UUID).
     * @param PaymentDetailsRequest|null $body
     *
     * @return ApiResponse Response from the API call
     */
    public function getPaymentDetails(?string $idempotencyKey = null, ?PaymentDetailsRequest $body = null): ApiResponse
    {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/payments/details')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                HeaderParam::init('Content-Type', 'application/json'),
                HeaderParam::init('Idempotency-Key', $idempotencyKey),
                BodyParam::init($body)
            );

        $_resHandler = $this->responseHandler()
            ->throwErrorOn(
                '400',
                ErrorType::init(
                    'Bad Request - a problem reading or understanding the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '401',
                ErrorType::init('Unauthorized - authentication required.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '403',
                ErrorType::init(
                    'Forbidden - insufficient permissions to process the request.',
                    ServiceErrorException::class
                )
            )
            ->throwErrorOn(
                '422',
                ErrorType::init('Unprocessable Entity - a request validation error.', ServiceErrorException::class)
            )
            ->throwErrorOn(
                '500',
                ErrorType::init(
                    'Internal Server Error - the server could not process the request.',
                    ServiceErrorException::class
                )
            )
            ->type(PaymentDetailsResponse::class)
            ->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Creates a payment session for [Drop-in](https://docs.adyen.com/online-payments/build-your-
     * integration/sessions-flow/?platform=Web&integration=Drop-in), [Components](https://docs.adyen.
     * com/online-payments/build-your-integration/sessions-flow/?platform=Web&integration=Components), and
     * [Hosted Checkout](https://docs.adyen.com/online-payments/build-your-integration/sessions-flow/?
     * platform=Web&integration=Hosted+Checkout) integrations.
     *
     * The response contains encrypted payment session data. The front end then uses the session data to
     * make any required server-side calls for the payment flow.
     *
     * You get the payment outcome asynchronously, in an [AUTHORISATION](https://docs.adyen.com/api-
     * explorer/#/Webhooks/latest/post/AUTHORISATION) webhook.
     *
     * @param string|null $idempotencyKey A unique identifier for the message with a maximum of 64
     *        characters (we recommend a UUID).
     * @param CreateCheckoutSessionRequest|null $body
     *
     * @return ApiResponse Response from the API call
     */
    public function createCheckoutSession(
        ?string $idempotencyKey = null,
        ?CreateCheckoutSessionRequest $body = null
    ): ApiResponse {
        $_reqBuilder = $this->requestBuilder(RequestMethod::POST, '/sessions')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                HeaderParam::init('Content-Type', 'application/json'),
                HeaderParam::init('Idempotency-Key', $idempotencyKey),
                BodyParam::init($body)
            );

        $_resHandler = $this->responseHandler()->type(CreateCheckoutSessionResponse::class)->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }

    /**
     * Returns the status of the payment session with the `sessionId` and `sessionResult` specified in the
     * path.
     *
     * @param string $sessionId A unique identifier of the session.
     * @param string $sessionResult The `sessionResult` value from the Drop-in or Component.
     *
     * @return ApiResponse Response from the API call
     */
    public function getCheckoutSession(string $sessionId, string $sessionResult): ApiResponse
    {
        $_reqBuilder = $this->requestBuilder(RequestMethod::GET, '/sessions/{sessionId}')
            ->auth('BasicAuth', 'ApiKeyAuth')
            ->parameters(
                TemplateParam::init('sessionId', $sessionId)->required(),
                QueryParam::init('sessionResult', $sessionResult)->required()
            );

        $_resHandler = $this->responseHandler()->type(SessionResultResponse::class)->returnApiResponse();

        return $this->execute($_reqBuilder, $_resHandler);
    }
}
